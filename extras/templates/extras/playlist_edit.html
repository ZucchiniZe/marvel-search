{% extends 'base.html' %}
{% load staticfiles %}
{% load helpers %}

{% block title %}Editing {{ playlist.title }}{% endblock %}

{% block content %}
  {% verbatim %}
  <div id="playlist-app">
    <div class="messages" v-if="messages.length > 0">
      <div v-for="message in messages" class="message" :class="message.type">
        {{ message.text }}
      </div>
    </div>
    <h1>Editing {{ title }}</h1>
    <form @submit.prevent="sendForm" class="pure-form pure-form-aligned">
      <fieldset>
        <div class="pure-control-group">
          <label for="title">title: </label>
          <input id="title" v-model="title">
        </div>
        <div class="pure-control-group">
          <label for="desc">description: </label>
          <textarea id="desc" rows="5" cols="40" v-model="description"></textarea>
        </div>
        <div class="pure-control-group">
          <label for="issue-searchsue">issues: </label>
          <input id="issue-search" v-model="q" debounce="250" placeholder="search for issues (use specific numbers)" size="30">
        </div>
        <div class="pure-controls">
          <button type="submit" class="pure-button pure-button-primary">Submit</button>
        </div>
      </fieldset>
    </form>
    <ul>
      <li v-for="issue in searchResults">
        {{ issue.title }}
        <a href="#" @click.prevent="addIssue(issue)">add</a>
      </li>
    </ul>

    <template v-if="issues.length > 0">
      <p>added issues (drag to re-order)</p>
      <ul v-droper="issues">
        <li v-dragable v-for="issue in issues">
          {{ issue.title }}
          <a href="#" @click.prevent="removeIssue($index)">remove</a>
        </li>
      </ul>
    </template>
  </div>
  {% endverbatim %}
{% endblock %}

{% block script %}
  <script>
    window.data = {
      title: '{{ playlist.title }}',
      description: '{{ playlist.description }}',
      items: {{ items|safe }}.map(function(element) {
        var ids = {id: element.pk};
        for (var attr in ids) { element.fields[attr] = ids[attr] }
        return element.fields;
      })
    };
  </script>
  <script src="{% static 'extras/cookie.js' %}"></script>
  <script src="{% static 'extras/vue.min.js' %}"></script>
  <script src="{% static 'extras/vue-deps.js' %}"></script>
  <script src="{% static 'extras/playlist.js' %}"></script>
{% endblock %}